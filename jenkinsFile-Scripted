  node {
    agent {
      dockerfile {
        filename 'DockerFile'
        args '--privileged'
        label 'zip-job-docker'
      }
    }
    environment{
      VERSION = '1.2.0'
    }
    tools{
      maven "maven"
    }
    stage('Server'){
       def server = Artifactory.server 'My_Artifactory'
       server.url: 'artifactory-url' 
       server.username: 'super-user' 
       server.password: 'Qw12856!' 
       server.bypassProxy: true 
       server.onnection.timeout: 300
       
    }
    stage('Build'){
        steps{
             script{
                   try {
                     sh 'python3 ./zip_job.py'
                   }
                   catch (Exception e) {
                      currentBuild.result = 'FAILURE'
                      stageResultMap.didBuildSucceeded = false
                   }
             }
        }
    }
    stage('Publish'){
        steps {
             rtUpload (
                    serverId: 'My_Artifactory' , 
                    def uploadSpec =  
                    '''{
                           "files": 
                           [
                                  {
                                       "pattern": "./*.zip",
                                       "target": "repository/${VERSION}/"                                       
                                  }
                           ]
                    }'''
                    server.upload spec:uploadSpec
             )
         }
    }
    stage('Report'){
        steps {
             echo 'Send Mail'
             emailext body: 'This is job status', subject: "Jenkins Build ${currentBuild.currentResult}", to: 'dan998835@gmail.com'
        }
    }
    stage('Cleanup'){
        steps{
             sh 'rm -rf $WORKSPACE/*'
        } 
    }
}
