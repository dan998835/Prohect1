  node {
    checkout scm
    def dockerfile = 'DockerFile'
    def buildImage = docker.build("image", "-f ${dockerfile} --privileged .")
    environment{
      VERSION = '1.2.0'
    }
    def rtServer = Artifactory.server 'My_Artifactory'
    def rtMaven = Artifactory.newMavenBuild()
    def buildInfo = Artifactory.newBuildInfo()
    stage('Server Configuration'){
       rtServer.url = 'artifactory-url' 
       rtServer.username = 'super-user' 
       rtServer.password = 'Qw12856!' 
       rtServer.bypassProxy = true 
       rtServer.connection.timeout = 300
       rtMaven.tool = 'maven'
    }
    stage('Build'){
       try 
       {
            sh 'python3 ./zip_job.py'
       }
       catch (all) 
       {
            currentBuild.result = 'FAILURE'
       }
    }
    if(currentBuild.result != 'FAILURE'){
        stage('Publish'){
           def uploadSpec = """{
                "files": [
                   {
                         "pattern": "./*.zip" ,
                         "target": "repository/${VERSION}/"                                       
                   }
                ]
            }"""
            server.upload(uploadSpec)
        }
    }
    stage('Report'){
             echo 'Send Mail'
             emailext body: 'This is job status', subject: "Jenkins Build ${currentBuild.currentResult}", to: 'dan998835@gmail.com'
    }
    stage('Cleanup'){
             sh 'rm -rf $WORKSPACE/*' 
    }
}
