  node ('zip-job-docker') {
    agent {
      dockerfile {
        filename 'DockerFile'
        args '--privileged'
      } 
    }
    environment{
      VERSION = '1.2.0'
    }
    def rtServer = Artifactory.server 'My_Artifactory'
    def rtMaven = Artifactory.newMavenBuild()
    def buildInfo = Artifactory.newBuildInfo()
    stage('Server Configuration'){
       rtServer.url = 'artifactory-url' 
       rtServer.username = 'super-user' 
       rtServer.password = 'Qw12856!' 
       rtServer.bypassProxy = true 
       rtServer.connection.timeout = 300
       rtMaven.tool = 'maven'
    }
    stage('Build'){
       try 
       {
            sh 'python3 ./zip_job.py'
       }
       catch (Exception e) 
       {
            currentBuild.result = 'FAILURE'
            stageResultMap.didBuildSucceeded = false
       }
    }
    stage('Publish'){
       def uploadSpec = """{
            "files": [
               {
                     "pattern": "./*.zip",
                     "target": "repository/${VERSION}/"                                       
               }
            ]
        }'''
        server.upload spec : uploadSpec
    }
    stage('Report'){
             echo 'Send Mail'
             emailext body: 'This is job status', subject: "Jenkins Build ${currentBuild.currentResult}", to: 'dan998835@gmail.com'
    }
    stage('Cleanup'){
             sh 'rm -rf $WORKSPACE/*' 
    }
}
